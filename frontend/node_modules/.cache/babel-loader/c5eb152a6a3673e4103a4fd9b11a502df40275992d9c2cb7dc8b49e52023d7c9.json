{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\jyoti\\\\Downloads\\\\E-Library-app-main\\\\E-Library-app-main\\\\frontend\\\\src\\\\components\\\\context\\\\AuthContext.js\",\n  _s = $RefreshSig$();\nimport React, { createContext, useEffect, useState } from 'react';\nimport axios from 'axios';\nimport { base_url } from '../../App';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport default AuthContext;\nexport const AuthProvider = _ref => {\n  _s();\n  let {\n    children\n  } = _ref;\n  const [isAuth, setIsAuth] = useState(false);\n  const [person, setPerson] = useState([]);\n  const loginUser = async event => {\n    event.preventDefault();\n    let auth_user = {\n      username: event.target.username.value,\n      password: event.target.password.value\n    };\n    await axios.post(base_url + 'token/', auth_user, {\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }, {\n      withCredentials: true\n    }).then(response => {\n      localStorage.clear();\n      localStorage.setItem('access_token', response.data.access);\n      localStorage.setItem('refresh_token', response.data.refresh);\n      axios.defaults.headers.common['Authorization'] = `Bearer ${response.data['access']}`;\n      window.location.href = '/';\n      setIsAuth(true);\n    }).catch(error => {\n      console.log(error);\n    });\n  };\n  let logoutUser = async () => {\n    if (localStorage.getItem('access_token') !== null) {\n      await axios.post(base_url + 'logout/', {\n        refresh_token: localStorage.getItem('refresh_token')\n      }, {\n        headers: {\n          'Content-Type': 'application/json',\n          'Authorization': `Bearer ${localStorage.getItem('access_token')}`\n        }\n      }).then(response => {\n        console.log(`You logged out. ${response.status}`);\n        localStorage.clear();\n        axios.defaults.headers.common['Authorization'] = null;\n        setIsAuth(false);\n      }).catch(error => {\n        console.log(error);\n      });\n    }\n  };\n  const decodeJWT = token => {\n    const parts = token.split('.');\n    if (parts.length !== 3) {\n      throw new Error('Invalid token format');\n    }\n    const payload = JSON.parse(atob(parts[1]));\n    return {\n      payload\n    };\n  };\n  if (localStorage.getItem('access_token') !== null) {}\n  ;\n  let contextData = {\n    isAuth: isAuth,\n    person: person,\n    loginUser: loginUser,\n    logoutUser: logoutUser\n  };\n  useEffect(() => {\n    if (localStorage.getItem('access_token') !== null) {\n      setIsAuth(true);\n      const userId = decodeJWT(localStorage.getItem('access_token')).payload.user_id;\n      (async () => {\n        await axios.get(base_url + `account-detail/${userId}/`, {\n          headers: {\n            'Content-Type': 'application/json',\n            'Authorization': `Bearer ${localStorage.getItem('access_token')}`\n          }\n        }).then(response => {\n          setPerson(response.data);\n        }).catch(error => {\n          console.log(error);\n        });\n      })();\n    }\n  }, []);\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: contextData,\n    children: children\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 9\n  }, this);\n};\n_s(AuthProvider, \"ZXywdBHaX3E1N3wEGqZxEtSNhCU=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useEffect","useState","axios","base_url","jsxDEV","_jsxDEV","AuthContext","AuthProvider","_ref","_s","children","isAuth","setIsAuth","person","setPerson","loginUser","event","preventDefault","auth_user","username","target","value","password","post","headers","withCredentials","then","response","localStorage","clear","setItem","data","access","refresh","defaults","common","window","location","href","catch","error","console","log","logoutUser","getItem","refresh_token","status","decodeJWT","token","parts","split","length","Error","payload","JSON","parse","atob","contextData","userId","user_id","get","Provider","fileName","_jsxFileName","lineNumber","columnNumber","_c","$RefreshReg$"],"sources":["C:/Users/jyoti/Downloads/E-Library-app-main/E-Library-app-main/frontend/src/components/context/AuthContext.js"],"sourcesContent":["import React, {createContext, useEffect, useState} from 'react';\nimport axios from 'axios';\nimport { base_url } from '../../App';\n\nconst AuthContext = createContext()\n\nexport default AuthContext;\n\nexport const AuthProvider = ({children}) => {\n    const [isAuth, setIsAuth] = useState(false)\n    const [person, setPerson] = useState([])\n    \n    const loginUser = async (event)=>{\n        event.preventDefault()\n        let auth_user = {\n            username: event.target.username.value,\n            password: event.target.password.value\n        }\n        await axios.post(base_url+'token/', \n        auth_user, {headers: {'Content-Type': 'application/json'}}, {withCredentials: true})\n        .then(response =>{\n            localStorage.clear();\n            localStorage.setItem('access_token', response.data.access);\n            localStorage.setItem('refresh_token', response.data.refresh);\n            axios.defaults.headers.common['Authorization'] =`Bearer ${response.data['access']}`;\n            window.location.href = '/';\n            setIsAuth(true)\n        })\n        .catch(error => {console.log(error)})\n    };\n        \n    let logoutUser = async () => {\n        if (localStorage.getItem('access_token') !== null){\n            await axios.post(base_url+'logout/',\n            {refresh_token:localStorage.getItem('refresh_token')},\n            {headers: {\n                'Content-Type': 'application/json',\n                'Authorization': `Bearer ${localStorage.getItem('access_token')}`}})\n            .then(response => {\n                console.log(`You logged out. ${response.status}`)\n                localStorage.clear();\n                axios.defaults.headers.common['Authorization'] = null;\n                setIsAuth(false)\n            })\n            .catch(error => {console.log(error)});\n        }\n    };\n\n    const decodeJWT =(token)=> {\n        const parts = token.split('.');\n        if (parts.length !== 3) {\n          throw new Error('Invalid token format');\n        }\n        const payload = JSON.parse(atob(parts[1]));\n        return { payload };\n    };\n\n    if (localStorage.getItem('access_token') !== null){\n        \n    };\n\n    let contextData = {\n        isAuth: isAuth,\n        person: person,\n        loginUser:loginUser,\n        logoutUser:logoutUser,\n    }\n    useEffect(()=>{\n        if (localStorage.getItem('access_token') !== null){\n            setIsAuth(true)\n            const userId = decodeJWT(localStorage.getItem('access_token')).payload.user_id;\n            (async()=> {\n                await axios.get(base_url + `account-detail/${userId}/`,\n                {headers: {\n                    'Content-Type': 'application/json', \n                    'Authorization': `Bearer ${localStorage.getItem('access_token')}`}})\n                .then(response => {\n                    setPerson(response.data)\n                })\n                .catch(error => {console.log(error)});\n            })()\n        }\n    },[])\n\n    return(\n        <AuthContext.Provider value={contextData}>\n            {children}\n        </AuthContext.Provider>\n    )\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}